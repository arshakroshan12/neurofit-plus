<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NeuroFit+ — Demo UI</title>

<style>
/* ------------------------------
   Modern Clean UI Styling
--------------------------------*/
:root {
  --primary: #0b72ff;
  --primary-hover: #005de0;
  --bg: #f3f5fa;
  --card-bg: #ffffff;
  --accent: #11c976;
  --warn: #ff8c42;
  --text: #1f2937;
  --muted: #6b7280;
  --border: #e5e7eb;
  --radius: 14px;
  --shadow: 0 8px 24px rgba(0,0,0,0.06);
  --font: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", Roboto, sans-serif;
}

/* Reset */
body {
  margin: 0;
  padding: 20px;
  background: var(--bg);
  font-family: var(--font);
  color: var(--text);
}

/* Container */
.card {
  background: var(--card-bg);
  padding: 28px;
  border-radius: var(--radius);
  max-width: 900px;
  margin: 0 auto;
  box-shadow: var(--shadow);
}

h1 {
  font-size: 24px;
  margin: 0;
  font-weight: 700;
}

.section-title {
  margin: 24px 0 8px;
  font-size: 18px;
  font-weight: 600;
}

label {
  font-weight: 600;
  font-size: 14px;
  margin-top: 14px;
  display: block;
}

input, textarea {
  width: 100%;
  border-radius: 10px;
  padding: 10px;
  margin-top: 6px;
  border: 1px solid var(--border);
  font-size: 14px;
}

textarea {
  resize: vertical;
}

.row {
  display: flex;
  gap: 18px;
}

.col {
  flex: 1;
}

button {
  border: none;
  padding: 12px 18px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}

/* Buttons */
.btn-primary {
  background: var(--primary);
  color: white;
}
.btn-primary:hover {
  background: var(--primary-hover);
}

.btn-reaction {
  background: var(--warn);
  color: #fff;
}
.btn-reaction.ready {
  background: var(--accent);
  color: #fff;
}

.badge {
  background: #e8eeff;
  color: var(--primary);
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 12px;
}

.small {
  font-size: 14px;
  color: var(--muted);
}

pre {
  background: #0f172a;
  color: #dbeafe;
  padding: 16px;
  border-radius: 10px;
  overflow-x: auto;
}

.metric-box {
  background: #f0f4ff;
  padding: 10px 14px;
  border-radius: 10px;
  margin-top: 8px;
  font-size: 14px;
}

.metric-title {
  color: var(--muted);
  font-size: 12px;
}
.metric-value {
  font-size: 16px;
  font-weight: bold;
  margin-top: 2px;
  color: var(--primary-hover);
}

/* Spacing helpers */
.flex-between {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.mt-2 { margin-top: 16px; }
.mt-3 { margin-top: 22px; }

</style>
</head>

<body>
<div class="card">

  <div class="flex-between">
    <h1>NeuroFit+ — Cognitive Fatigue Demo</h1>
    <span class="badge">DEMO</span>
  </div>

  <div class="small" style="margin-bottom:20px;">
    This UI collects typing metrics, sleep/stress inputs, and a reaction test → and posts them to  
    <code>/predict_fatigue</code>.
  </div>

  <!-- Timestamp -->
  <label>Timestamp
    <input id="timestamp" type="text" />
  </label>

  <!-- Sleep / Energy / Stress -->
  <div class="section-title">Wellbeing Inputs</div>

  <div class="row">
    <div class="col">
      <label>Sleep hours (0–12)
        <input id="sleep_hours" type="number" min="0" max="12" value="6" />
      </label>
    </div>
    <div class="col">
      <label>Energy (0–10)
        <input id="energy_level" type="number" min="0" max="10" value="5" />
      </label>
    </div>
    <div class="col">
      <label>Stress (0–10)
        <input id="stress_level" type="number" min="0" max="10" value="3" />
      </label>
    </div>
  </div>

  <!-- Typing -->
  <div class="section-title">Typing Assessment</div>
  <label>Type something (we compute your typing speed + behavior)
    <textarea id="typing_area" rows="5"></textarea>
  </label>

  <div class="row mt-2">
    <div class="col">
      <div class="metric-box">
        <div class="metric-title">Avg Latency</div>
        <div class="metric-value" id="avg_latency">—</div>
      </div>
    </div>
    <div class="col">
      <div class="metric-box">
        <div class="metric-title">Total Duration</div>
        <div class="metric-value" id="total_duration">—</div>
      </div>
    </div>
    <div class="col">
      <div class="metric-box">
        <div class="metric-title">Backspace Rate</div>
        <div class="metric-value" id="backspace_rate">—</div>
      </div>
    </div>
  </div>

  <!-- Reaction Test -->
  <div class="section-title mt-3">Reaction Test</div>

  <div class="row">
    <div class="col">
      <button id="reaction_btn" class="btn-reaction">Start Reaction Test</button>
      <div id="reaction_status" class="small mt-2">Not started</div>
    </div>

    <div class="col">
      <div class="metric-box">
        <div class="metric-title">Reaction Time</div>
        <div class="metric-value" id="reaction_time">—</div>
      </div>
    </div>
  </div>

  <!-- Predict -->
  <div class="flex-between mt-3">
    <div class="small">POST → <code>/predict_fatigue</code></div>
    <button id="send_btn" class="btn-primary">Run Prediction</button>
  </div>

  <!-- Response -->
  <div class="section-title">Response</div>
  <pre id="result">{ "status": "awaiting" }</pre>

</div>

<script>
/* --- JavaScript Logic (same functionality, cleaner UI) --- */
const $ = id => document.getElementById(id);

const typingArea = $('typing_area');
const avgLatencyEl = $('avg_latency');
const totalDurationEl = $('total_duration');
const backspaceRateEl = $('backspace_rate');
const reactionBtn = $('reaction_btn');
const reactionStatus = $('reaction_status');
const reactionTimeEl = $('reaction_time');
const sendBtn = $('send_btn');
const resultEl = $('result');
const timestampEl = $('timestamp');

let keyTimes = [];
let typingStart = null;
let typingEnd = null;
let backspaceCount = 0;

// Typing metrics
typingArea.addEventListener('keydown', e => {
  const now = performance.now();
  if (!typingStart) typingStart = now;
  keyTimes.push(now);
  if (e.key === 'Backspace') backspaceCount++;
});

typingArea.addEventListener('blur', computeTyping);

function computeTyping(){
  if (keyTimes.length < 2) return;

  // latencies
  let deltas = [];
  for (let i=1;i<keyTimes.length;i++) deltas.push(keyTimes[i]-keyTimes[i-1]);

  const avg = deltas.reduce((a,b)=>a+b,0) / deltas.length;
  const total = (keyTimes[keyTimes.length-1] - keyTimes[0]);
  const rate = backspaceCount / keyTimes.length;

  avgLatencyEl.textContent = Math.round(avg);
  totalDurationEl.textContent = Math.round(total);
  backspaceRateEl.textContent = rate.toFixed(3);
}

// Reaction test
let reactionStart = null;
let timeoutHandle = null;

reactionBtn.addEventListener('click', () => {
  if (timeoutHandle){
    clearTimeout(timeoutHandle);
    resetReaction("Cancelled");
    return;
  }
  reactionStatus.textContent = "Wait for green...";
  reactionBtn.classList.remove('ready');
  reactionBtn.textContent = "Waiting…";

  timeoutHandle = setTimeout(()=>{
    reactionBtn.textContent = "CLICK!";
    reactionBtn.classList.add('ready');
    reactionStatus.textContent = "Click now!";
    reactionStart = performance.now();
  }, 700 + Math.random()*1500);
});

reactionBtn.addEventListener('mousedown', () => {
  if (!reactionStart){
    // early click
    if (timeoutHandle){
      resetReaction("Too early — reset");
    }
    return;
  }
  const r = performance.now() - reactionStart;
  reactionTimeEl.textContent = Math.round(r);
  resetReaction("Measured");
});

function resetReaction(msg){
  reactionStatus.textContent = msg;
  reactionBtn.textContent = "Start Reaction Test";
  reactionBtn.classList.remove('ready');
  reactionStart = null;
  if (timeoutHandle){
    clearTimeout(timeoutHandle);
    timeoutHandle = null;
  }
}

// Prediction
sendBtn.addEventListener('click', async () => {
  computeTyping();
  const payload = {
    timestamp: timestampEl.value || new Date().toISOString(),
    answers: [
      {question_id:"sleep_hours", value: Number($('sleep_hours').value)},
      {question_id:"energy_level", value: Number($('energy_level').value)},
      {question_id:"stress_level", value: Number($('stress_level').value)},
    ],
    typing_features: {
      average_latency_ms: Number(avgLatencyEl.textContent) || 0,
      total_duration_ms: Number(totalDurationEl.textContent) || 0,
      backspace_rate: Number(backspaceRateEl.textContent) || 0,
    },
    task_performance: {
      reaction_time_ms: reactionTimeEl.textContent === '—' ? null : Number(reactionTimeEl.textContent),
      reaction_attempted: reactionTimeEl.textContent !== '—'
    }
  };

  resultEl.textContent = "Sending...";
  try{
    const res = await fetch('/predict_fatigue', {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    const json = await res.json();
    resultEl.textContent = JSON.stringify(json, null, 2);
  } catch(err){
    resultEl.textContent = "Error: " + err.message;
  }
});

// init timestamp
timestampEl.value = new Date().toISOString();

</script>
</body>
</html>
